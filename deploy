#!/usr/bin/env bash
# ========================================
# 🚀 Deploy Universal (fix working dir)
# ========================================

# --- Bash (Linux/Mac/WSL/Git Bash) ---
if [ "$(uname 2>/dev/null)" = "Linux" ] || [ "$(uname 2>/dev/null)" = "Darwin" ] || [ "$(uname -o 2>/dev/null)" = "Msys" ]; then
  REPO_DIR="$(pwd)"
  echo "🔄 Deploy (Bash) a partir de: $REPO_DIR"
  wrangler pages deploy "$REPO_DIR/public" --project-name=framework-padrao-synapse-b2b --commit-dirty=true
  exit $?
fi

# Tudo abaixo é ignorado pelo Bash
: <<'POWERSHELL'
# --- PowerShell (Windows) ---
POWERSHELL

$repo = Split-Path -Parent $MyInvocation.MyCommand.Path
Write-Host "🔄 Deploy (PowerShell) a partir de: $repo" -ForegroundColor Cyan
Push-Location $repo
try {
  wrangler pages deploy "$repo\public" --project-name=framework-padrao-synapse-b2b --commit-dirty=true
  if ($LASTEXITCODE -eq 0) {
    Write-Host "✅ Deploy concluído com sucesso!" -ForegroundColor Green
    Write-Host "🌎 Verifique em: https://framework-padrao-synapse-b2b.pages.dev" -ForegroundColor Yellow
  } else {
    throw "❌ Deploy falhou com exit code $LASTEXITCODE"
  }
} finally {
  Pop-Location
}
Pause
